# 🚀 Deploying to Render - Complete Guide

This guide provides step-by-step instructions for deploying your AI Quiz & Flashcard Generator to Render.com.

## 📋 Prerequisites

Before deploying, ensure you have:
- A GitHub account
- A Render.com account ([Sign up here](https://render.com))
- Your repository pushed to GitHub
- OpenRouter API key
- Firecrawl API key (optional, for website scraping)

## 🔧 Pre-Deployment Checklist

✅ All changes from this guide have been applied:
- ✅ `backend/requirements.txt` includes Gunicorn
- ✅ `backend/app.py` configured for production
- ✅ `script.js` updated with environment-aware backend URL
- ✅ `render.yaml` configuration file created

## 🎯 Deployment Strategy

This app uses a **two-service deployment**:
1. **Backend** - Python Flask API (Web Service)
2. **Frontend** - Static HTML/CSS/JS (Static Site)

## 📝 Step-by-Step Deployment

### Step 1: Push Code to GitHub

1. Ensure all changes are committed:
   ```bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   ```

### Step 2: Deploy Backend (Flask API)

1. Log in to [Render Dashboard](https://dashboard.render.com)
2. Click **"New +"** → **"Web Service"**
3. Connect your GitHub repository
4. Configure the service:

   **Basic Settings:**
   - **Name**: `ai-quiz-backend` (or your preferred name)
   - **Region**: Choose closest to your users (e.g., Oregon)
   - **Branch**: `main` (or your default branch)
   - **Root Directory**: Leave blank
   - **Runtime**: `Python 3`

   **Build & Deploy Settings:**
   - **Build Command**: 
     ```
     pip install -r backend/requirements.txt
     ```
   - **Start Command**: 
     ```
     gunicorn --chdir backend --bind 0.0.0.0:$PORT app:app
     ```

   **Advanced Settings (Click "Advanced"):**
   - **Environment Variables**:
     - `PYTHON_VERSION` = `3.11.0`
     - Add any other environment variables your app needs

   **Instance Type:**
   - Select **Free** (for testing) or **Starter** (for production)

5. Click **"Create Web Service"**
6. Wait for deployment to complete (5-10 minutes)
7. **Copy your backend URL** (e.g., `https://ai-quiz-backend.onrender.com`)

### Step 3: Update Frontend with Backend URL

1. Open `script.js` in your local repository
2. Find this line:
   ```javascript
   const BACKEND_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
       ? 'http://localhost:5000'
       : 'https://your-backend-name.onrender.com'; // Replace with your actual Render backend URL
   ```
3. Replace `'https://your-backend-name.onrender.com'` with your **actual backend URL** from Step 2
4. Save the file
5. Commit and push:
   ```bash
   git add script.js
   git commit -m "Update backend URL for production"
   git push origin main
   ```

### Step 4: Deploy Frontend (Static Site)

1. In Render Dashboard, click **"New +"** → **"Static Site"**
2. Connect the same GitHub repository
3. Configure the service:

   **Basic Settings:**
   - **Name**: `ai-quiz-frontend` (or your preferred name)
   - **Branch**: `main`
   - **Root Directory**: Leave blank

   **Build Settings:**
   - **Build Command**: (leave blank or use `echo "No build needed"`)
   - **Publish Directory**: `.` (current directory)

4. Click **"Create Static Site"**
5. Wait for deployment (2-5 minutes)
6. **Copy your frontend URL** (e.g., `https://ai-quiz-frontend.onrender.com`)

### Step 5: Test Your Deployment

1. Visit your frontend URL
2. Enter your OpenRouter API key and model name
3. Test all features:
   - ✅ Document upload and quiz generation
   - ✅ YouTube video transcript fetching
   - ✅ Website scraping (with Firecrawl API key)
   - ✅ Flashcard generation

## 🔒 Environment Variables

### Backend Service Environment Variables

Set these in your backend web service settings:

| Variable | Description | Required |
|----------|-------------|----------|
| `PYTHON_VERSION` | Python version (e.g., `3.11.0`) | Yes |
| `PORT` | Auto-generated by Render | Auto |

**Note**: API keys (OpenRouter, Firecrawl) are entered by users in the frontend, not stored in backend.

## 🌐 Custom Domain (Optional)

### For Frontend:
1. Go to your static site settings
2. Click **"Custom Domain"**
3. Add your domain and follow DNS instructions

### For Backend:
1. Go to your web service settings
2. Click **"Custom Domain"**
3. Add your API subdomain (e.g., `api.yourdomain.com`)
4. Update `script.js` with your custom domain

## 🐛 Troubleshooting

### Backend Issues

**Problem**: Backend won't start
- **Solution**: Check build logs for errors
- Verify `requirements.txt` has all dependencies
- Ensure Python version is set correctly

**Problem**: Health check failing
- **Solution**: Verify `/health` endpoint works
- Check if Gunicorn is binding to correct port

**Problem**: CORS errors in browser
- **Solution**: Update CORS settings in `backend/app.py`
- Replace `"origins": "*"` with your frontend domain:
  ```python
  CORS(app, resources={r"/api/*": {"origins": "https://your-frontend.onrender.com"}})
  ```

### Frontend Issues

**Problem**: Can't connect to backend
- **Solution**: Verify backend URL in `script.js` is correct
- Check browser console for errors
- Ensure backend service is running

**Problem**: YouTube/Website features not working
- **Solution**: Check backend logs for errors
- Verify backend service is running
- Test API endpoints directly

### Deployment Issues

**Problem**: Free tier limitations
- **Solution**: 
  - Free services sleep after 15 min of inactivity
  - First request may take 30-60 seconds to wake up
  - Upgrade to paid plan for always-on service

**Problem**: Build fails
- **Solution**: Check build logs
- Verify all files are committed and pushed
- Ensure build commands are correct

## 💰 Cost Considerations

### Free Tier Includes:
- ✅ 750 hours/month for web services
- ✅ 100 GB bandwidth/month
- ✅ Unlimited static sites
- ❌ Services sleep after 15 min inactivity
- ❌ Slower build times

### Paid Plans:
- **Starter**: $7/month per service
  - Always-on
  - Faster builds
  - More resources

## 🔄 Continuous Deployment

Render automatically deploys when you push to your connected branch:

1. Make changes locally
2. Commit and push to GitHub
3. Render automatically builds and deploys
4. Check deployment status in dashboard

To disable auto-deploy:
- Go to service settings
- Disable "Auto-Deploy"

## 📊 Monitoring

### View Logs:
1. Go to your service dashboard
2. Click **"Logs"** tab
3. Monitor real-time application logs

### Health Checks:
- Backend: `https://your-backend.onrender.com/health`
- Should return: `{"status": "healthy"}`

### Performance:
- Monitor response times in logs
- Check for errors or warnings
- Upgrade instance type if needed

## 🔐 Security Best Practices

1. **API Keys**: Never commit API keys to repository
   - Users enter keys in frontend (not stored)
   - Keys stored only in browser memory

2. **CORS**: Restrict to your frontend domain in production
   ```python
   CORS(app, resources={r"/api/*": {"origins": "https://your-frontend.onrender.com"}})
   ```

3. **HTTPS**: Render provides free SSL certificates
   - Always use HTTPS URLs
   - No additional configuration needed

4. **Environment Variables**: Use Render's environment variable system
   - Never hardcode sensitive data
   - Access via `os.environ.get()`

## 📚 Additional Resources

- [Render Documentation](https://render.com/docs)
- [Flask Deployment Guide](https://flask.palletsprojects.com/en/2.3.x/deploying/)
- [Gunicorn Documentation](https://docs.gunicorn.org/)

## 🆘 Getting Help

If you encounter issues:
1. Check Render's [Status Page](https://status.render.com/)
2. Review [Render Community](https://community.render.com/)
3. Contact Render Support (paid plans)

---

**Congratulations! Your app is now live on Render! 🎉**

Share your frontend URL and start creating AI-powered quizzes!
